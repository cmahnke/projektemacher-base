{{- $common := dict "@context" "http://iiif.io/api/presentation/3/context.json" "type" "Manifest" "id" .Permalink "viewingDirection" "left-to-right" -}}
"@context": "http://iiif.io/api/presentation/3/context.json",
"type": "Manifest",
"id": "{{ .Permalink }}",
"viewingDirection": "left-to-right",
{{- $defaultBehavior := "paged" -}}

"behavior":
  {{- if and (isset .Params "iiif") (isset .Params.iiif "behavior") -}}
    {{ .Params.iiif.behavior | jsonify }}
  {{- else -}}
    ["{{ $defaultBehavior }}"]
  {{- end -}}
,

{{- $behavior := dict -}}
{{- if and (isset .Params "iiif") (isset .Params.iiif "behavior") -}}
  {{- $behavior = .Params.iiif.behavior -}}
{{- else -}}
  {{- $behavior = slice $defaultBehavior -}}
{{- end -}}

{{- if .Description -}}
  {{- $summary := partial "iiif/3/manifest-summary.json" . -}}
  "summary": {{- $summary | jsonify -}},
{{- end -}}

{{- if and (isset .Params "iiif") (isset .Params.iiif "rights") -}}
  {"rights", "{{ .Params.iiif.rights }}"},
{{- end -}}
"requiredStatement":{{ (partial "iiif/3/required-statement.json" .) | jsonify }},

{{/*
{{- $thumnail := trim (partial "iiif/3/thumbnail.json" .) "\n\t " -}}
{{- if ne $thumnail ""}}
  {{- $thumnail -}},
{{- end -}}
*/}}
{{- $thumnails := partial "iiif/3/thumbnail.json" . -}}
{{- if gt ($thumnails | len) 0 -}}
  "thumbnail": {{ $thumnails | jsonify }},
{{- end -}}


{{- partialCached "iiif/3/provider.json" . -}},

{{- $label := dict $.Site.Language.Lang (slice (printf "%s: %s" .Site.Title .Title)) -}}
{{- if hugo.IsMultilingual -}}
  {{- $translations := where .Translations ".Lang" "!=" $.Site.Language.Lang -}}
  {{- range $translations -}}
    {{- $label = $label | merge (dict .Lang (slice (printf "%s: %s" .Site.Title .Title))) -}}
  {{- end -}}
{{- end -}}
{{- $homepage := slice (dict "id" .Permalink "type" "Text" "format" "text/html" "label" $label) -}}

"homepage": {{ $homepage | jsonify }},

{{- $label := partial "iiif/3/manifest-label.json" . -}}
"label": {{ $label | jsonify }},
{{- if and (isset .Params "iiif") (isset .Params.iiif "metadata") -}}
  {{- jsonify .Params.iiif.metadata -}}
{{- end -}}
{{- if isset .Params "iiifMetadata" -}}
  {{- errorf "[single.iiii-metadata.json] .Params.iiifMetadata isn't supported anymore use .Params.iiif.metadata" -}}
{{- end -}}
{{- if and (isset .Params "iiif") (isset .Params.iiif "structure") -}}
  "structures": {{- jsonify .Params.iiif.structure -}}
{{- end -}}

{{- if isset .Params "iiifStructure" -}}
  {{- errorf "[single.iiii-metadata.json] .Params.iiifStructure isn't supported anymore use .Params.iiif.structure" -}}
{{- end -}}
