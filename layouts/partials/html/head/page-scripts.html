{{/* Merge this into script.html */}}

{{- $isServer := false -}}
{{- if gt hugo.Version "0.120.0" -}}
  {{- $isServer = hugo.IsServer -}}
{{- else -}}
  {{- $isServer = .Site.IsServer -}}
{{- end -}}

{{- if .Params.js -}}
    {{- $defines := dict "process.env.NODE_ENV" `"production"` -}}
    {{- if $isServer -}}
        {{ $defines = dict "process.env.NODE_ENV" `"development"` }}
    {{- end -}}
    {{- $fileName := "" -}}

    {{- $mainJs := slice -}}
    {{ range $script := .Params.js }}
        {{- $mainOpts := dict "targetPath" $script "defines" $defines -}}
        {{- $main := "" -}}
        {{- if not (or (hasPrefix $script "http") (hasPrefix $script "//")) -}}
          {{- $main = resources.Get $script | js.Build $mainOpts -}}
        {{- else -}}
          {{- $main = resources.GetRemote $script | js.Build $mainOpts -}}
        {{- end -}}
        {{- $mainJs = $mainJs | append $main -}}
        {{- $fileName = printf "%s%s" $fileName $script -}}
    {{- end -}}

    {{- if not $isServer -}}
        {{- $mainJs = $mainJs | resources.Concat (printf "js/%s.js" (md5 $fileName)) | minify | fingerprint -}}
    {{- else -}}
        {{- $mainJs = $mainJs | resources.Concat (printf "js/%s.js" (md5 $fileName)) | fingerprint -}}
    {{- end -}}
    <script src="{{ $mainJs.RelPermalink }}" integrity="{{ $mainJs.Data.Integrity | html }}"></script>
{{- end -}}
