{{- $geojson := .Params.geojson -}}
{{- $popupContent := partial "geojson/popupContent.html" . | jsonify -}}
{{- $defaultType := "Point" -}}
{{- $type := "" -}}
{{- $coordinates := "" -}}

{{- if ne (index $geojson "type") nil -}}
    {{- $type = index $geojson "type" -}}
{{- else -}}
    {{- $type = $defaultType -}}
{{- end -}}

{{- if ne (index $geojson "coordinates") nil -}}
    {{- $coordinates = index $geojson "coordinates" -}}
    {{- $coordinates = apply $coordinates "partial" "format-coords" "." -}}
{{- else -}}
    {{- errorf "No coordinates for %s" .File.Path -}}
{{- end -}}

{
  "type": "Feature",
  "properties": {
      "name": "{{ .Title }}",
      "popupContent": {{ $popupContent }}
  },
  "geometry": {
    "type": "{{ $type }}",
    "coordinates": {{ $coordinates | jsonify }}
  }
}

{{ define "partials/format-coords" }}
    {{ $value := . }}
    {{ return (printf "%.6f"  $value) }}
{{ end }}
